# Days Not At Home Daily
Running jobs for calculating the Daily (pings) Days Not At Home (DNAH) Metric and then
combining it with the Monthly (claims) Days Not At Home data

## What is this service, and what does it do?
The DNAH Daily service updates BigQuery tables with information on members on
the number of days they have not been home metric. This utilizes the Patient
Ping data we have streaming into our system on a continuous basis. As the data
refreshes on a daily cadence, running this job on a daily cadence updates the data in
a marginally meaningful way. 

## Who is responsible for it?
Platform and Actuary team

## What dependencies does it have?
Internal Services: Data in BigQuery generated by various processes (`cityblock-data` and `cityblock-analytics`)
and configuration file in the GCS bucket (JSON file)

GCP services: Cloud Composer (Airflow), GCR, BigQuery, GCS

## What does the infrastructure for it look like?
Run Docker image for daily Python job &#8594; Run Python job to combine these results with monthly data

## What metrics and logs does it emit, and what do they mean?
### Metrics
- Airflow UI contains history of past runs and their states (success, fail, scheduled,
manual, etc.)

### Logs
- Python processes: python container, funneled into Airflow, and available on GKE pod view (for limited time)

## What alerts are set up for it, and why?
- When any item in the DAG causes an exception, it is forwarded to the private
`airflow_alerts` Slack channel.

## Tips from the authors and pros
- If necessary, pull the Docker image to run locally 
[as mentioned in the source code README](https://gitlab.cityblock.com/data/picasso/-/blob/master/medical_economics/AIR/days_at_facility/README.md#building-pulling-and-running-docker-image)
- Consult [the source code](https://gitlab.cityblock.com/data/picasso/-/blob/master/medical_economics/AIR/days_at_facility/README.md)
on other components of the DNAH (like monthly Python job, SQL queries, and util methods)

## Appendix
- [DNAH source code](https://gitlab.cityblock.com/data/picasso/-/blob/master/medical_economics/AIR/days_at_facility/README.md)
- [Image in Container Registry](https://console.cloud.google.com/gcr/images/cbh-git/US/days_at_facility)
